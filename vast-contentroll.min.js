/*
 VAST content-roll

 @version 0.0.13
 @link https://github.com/nechehin/vast-contentroll
*/
(function(k,f){function g(a){this.time=a.time;this.target=a.target;this.rootBounds=a.rootBounds;this.boundingClientRect=a.boundingClientRect;this.intersectionRect=a.intersectionRect||p();this.isIntersecting=!!a.intersectionRect;a=this.boundingClientRect;a=a.width*a.height;var b=this.intersectionRect;b=b.width*b.height;this.intersectionRatio=a?b/a:this.isIntersecting?1:0}function c(a,d){var b=d||{};if("function"!=typeof a)throw Error("callback must be a function");if(b.root&&1!=b.root.nodeType)throw Error("root must be an Element");
    this._checkForIntersections=t(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT);this._callback=a;this._observationTargets=[];this._queuedEntries=[];this._rootMarginValues=this._parseRootMargin(b.rootMargin);this.thresholds=this._initThresholds(b.threshold);this.root=b.root||null;this.rootMargin=this._rootMarginValues.map(function(a){return a.value+a.unit}).join(" ")}function t(a,d){var b=null;return function(){b||(b=setTimeout(function(){a();b=null},d))}}function q(a,d,n,e){"function"==
typeof a.addEventListener?a.addEventListener(d,n,e||!1):"function"==typeof a.attachEvent&&a.attachEvent("on"+d,n)}function r(a,d,n,e){"function"==typeof a.removeEventListener?a.removeEventListener(d,n,e||!1):"function"==typeof a.detatchEvent&&a.detatchEvent("on"+d,n)}function h(a){try{var b=a.getBoundingClientRect()}catch(n){}if(!b)return p();b.width&&b.height||(b={top:b.top,right:b.right,bottom:b.bottom,left:b.left,width:b.right-b.left,height:b.bottom-b.top});return b}function p(){return{top:0,bottom:0,
    left:0,right:0,width:0,height:0}}function l(b,d){for(var e=d;e;){if(e==b)return!0;e=a(e)}return!1}function a(a){return(a=a.parentNode)&&11==a.nodeType&&a.host?a.host:a}if("IntersectionObserver"in k&&"IntersectionObserverEntry"in k&&"intersectionRatio"in k.IntersectionObserverEntry.prototype)"isIntersecting"in k.IntersectionObserverEntry.prototype||Object.defineProperty(k.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}});else{var e=[];c.prototype.THROTTLE_TIMEOUT=
    100;c.prototype.POLL_INTERVAL=null;c.prototype.observe=function(a){if(!this._observationTargets.some(function(b){return b.element==a})){if(!a||1!=a.nodeType)throw Error("target must be an Element");this._registerInstance();this._observationTargets.push({element:a,entry:null});this._monitorIntersections();this._checkForIntersections()}};c.prototype.unobserve=function(a){this._observationTargets=this._observationTargets.filter(function(b){return b.element!=a});this._observationTargets.length||(this._unmonitorIntersections(),
    this._unregisterInstance())};c.prototype.disconnect=function(){this._observationTargets=[];this._unmonitorIntersections();this._unregisterInstance()};c.prototype.takeRecords=function(){var a=this._queuedEntries.slice();this._queuedEntries=[];return a};c.prototype._initThresholds=function(a){a=a||[0];Array.isArray(a)||(a=[a]);return a.sort().filter(function(a,b,e){if("number"!=typeof a||isNaN(a)||0>a||1<a)throw Error("threshold must be a number between 0 and 1 inclusively");return a!==e[b-1]})};c.prototype._parseRootMargin=
    function(a){a=(a||"0px").split(/\s+/).map(function(a){a=/^(-?\d*\.?\d+)(px|%)$/.exec(a);if(!a)throw Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(a[1]),unit:a[2]}});a[1]=a[1]||a[0];a[2]=a[2]||a[0];a[3]=a[3]||a[1];return a};c.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(q(k,"resize",this._checkForIntersections,
    !0),q(f,"scroll",this._checkForIntersections,!0),"MutationObserver"in k&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(f,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))};c.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,r(k,"resize",this._checkForIntersections,!0),r(f,"scroll",this._checkForIntersections,!0),
this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))};c.prototype._checkForIntersections=function(){var a=this._rootIsInDom(),e=a?this._getRootRect():p();this._observationTargets.forEach(function(b){var d=b.element,c=h(d),n=this._rootContainsTarget(d),f=b.entry,l=a&&n&&this._computeTargetAndRootIntersection(d,e);b=b.entry=new g({time:k.performance&&performance.now&&performance.now(),target:d,boundingClientRect:c,rootBounds:e,intersectionRect:l});f?a&&n?this._hasCrossedThreshold(f,
    b)&&this._queuedEntries.push(b):f&&f.isIntersecting&&this._queuedEntries.push(b):this._queuedEntries.push(b)},this);this._queuedEntries.length&&this._callback(this.takeRecords(),this)};c.prototype._computeTargetAndRootIntersection=function(b,e){if("none"!=k.getComputedStyle(b).display){for(var d=h(b),c=a(b),g=!1;!g;){var m=null,l=1==c.nodeType?k.getComputedStyle(c):{};if("none"==l.display)return;c==this.root||c==f?(g=!0,m=e):c!=f.body&&c!=f.documentElement&&"visible"!=l.overflow&&(m=h(c));if(m){l=
    Math.max(m.top,d.top);var p=Math.min(m.bottom,d.bottom),q=Math.max(m.left,d.left);d=Math.min(m.right,d.right);m=d-q;var r=p-l;d=0<=m&&0<=r&&{top:l,bottom:p,left:q,right:d,width:m,height:r};if(!d)break}c=a(c)}return d}};c.prototype._getRootRect=function(){if(this.root)var a=h(this.root);else{a=f.documentElement;var d=f.body;a={top:0,left:0,right:a.clientWidth||d.clientWidth,width:a.clientWidth||d.clientWidth,bottom:a.clientHeight||d.clientHeight,height:a.clientHeight||d.clientHeight}}return this._expandRectByRootMargin(a)};
    c.prototype._expandRectByRootMargin=function(a){var b=this._rootMarginValues.map(function(b,e){return"px"==b.unit?b.value:b.value*(e%2?a.width:a.height)/100});b={top:a.top-b[0],right:a.right+b[1],bottom:a.bottom+b[2],left:a.left-b[3]};b.width=b.right-b.left;b.height=b.bottom-b.top;return b};c.prototype._hasCrossedThreshold=function(a,e){var b=a&&a.isIntersecting?a.intersectionRatio||0:-1,c=e.isIntersecting?e.intersectionRatio||0:-1;if(b!==c)for(var d=0;d<this.thresholds.length;d++){var f=this.thresholds[d];
        if(f==b||f==c||f<b!==f<c)return!0}};c.prototype._rootIsInDom=function(){return!this.root||l(f,this.root)};c.prototype._rootContainsTarget=function(a){return l(this.root||f,a)};c.prototype._registerInstance=function(){0>e.indexOf(this)&&e.push(this)};c.prototype._unregisterInstance=function(){var a=e.indexOf(this);-1!=a&&e.splice(a,1)};k.IntersectionObserver=c;k.IntersectionObserverEntry=g}})(window,document);
(function(){var k=document.createElement("script");k.async=!0;k.src="https://imasdk.googleapis.com/js/sdkloader/ima3.js";k.onload=function(){function f(a,e,b){e="data-"+e;return"undefined"!==typeof b?a.setAttribute(e,b):a.getAttribute(e)}function g(a,e,b){return"undefined"!==typeof b?f(a,e,b?"1":"0"):~["1","true"].indexOf(f(a,e))?!0:!1}function c(a,e,b){g(a,h.DEBUG)&&console.log("vast-contentroll:",e,b||"")}function k(a){g(a,h.CONTROLLS)||(g(a,h.CONTROLLS,1),a.muteButton=document.createElement("a"),
    a.muteButton.className="vast-contentroll--btn-mute",a.muteButton.textContent=0===a.adsManager.getVolume()?f(a,"unmute-text")||"Unmute":f(a,"mute-text")||"Mute",a.muteButton.style.position="relative",a.muteButton.style.padding="8px 16px",a.muteButton.style.backgroundColor="rgba(0,0,0,0.8)",a.muteButton.style.color="#e6e6e6",a.muteButton.style.fontFamily="arial",a.muteButton.style.fontSize="12px",a.muteButton.style.cursor="pointer",a.muteButton.onclick=function(){0===a.adsManager.getVolume()?(c(a,"unmute clicked"),
    a.adsManager.setVolume(1),this.textContent=f(a,"mute-text")||"Mute"):(a.adsManager.setVolume(0),c(a,"mute clicked"),this.textContent=f(a,"unmute-text")||"Unmute")},a.appendChild(a.muteButton))}function q(a){l.unobserve(a);a.style.display="none";a=f(a,"on-empty");if("function"===typeof window[a])window[a]()}function r(a){var e=a.clientWidth,b=a.parentNode.clientWidth,d=b/e*a.clientHeight;b>e?c(a,"adapt size skiped"):(a.style.position="relative",a.style.overflow="hidden",a.style.width=b+"px",a.style.height=
    d+"px",a.style.maxWidth="100%",c(a,"size adapted"))}var h={INIT:"init",LOADING:"loading",LOADED:"loaded",STARTED:"started",CONTROLLS:"controlls",DEBUG:"debug",COLLAPSE:"collapse",COMPANION:"companion",RESPONSIVE:"responsive"},p=document.getElementsByClassName("vast-contentroll"),l=new IntersectionObserver(function(a){[].forEach.call(a,function(a){"undefined"!==typeof a.isIntersecting&&!1===a.isIntersecting?(a=a.target,g(a,h.STARTED)&&(a.adsManager.pause(),c(a,"pauseAd"))):(a=a.target,g(a,h.STARTED)?
    (a.adsManager.resume(),c(a,"resumeAd")):g(a,h.LOADING)?c(a,"yet loading"):(c(a,"load"),a.adsRequest.adTagUrl=f(a,"vast"),a.adsLoader.requestAds(a.adsRequest),g(a,h.LOADING,1)))})},{threshold:0});[].forEach.call(p,function(a){g(a,h.INIT)||(g(a,h.RESPONSIVE)&&r(a),l.observe(a),a.adDisplayContainer=new google.ima.AdDisplayContainer(a),a.adDisplayContainer.initialize(),a.adsLoader=new google.ima.AdsLoader(a.adDisplayContainer),a.adsLoader.getSettings().setDisableCustomPlaybackForIOS10Plus(!0),a.adsRequest=
    new google.ima.AdsRequest,a.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){var b=document.createElement("video");b.muted=!0;b.autoplay=!0;b.playsinline=!0;a.adsManager=e.getAdsManager(b);a.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,function(b){g(a,h.LOADED,1)});a.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,function(b){g(a,h.STARTED,1);c(a,"ads started");k(a);if(g(a,h.COMPANION)){c(a,"get a list of companion ads");b=b.getAd();
    var d=new google.ima.CompanionAdSelectionSettings;d.resourceType=google.ima.CompanionAdSelectionSettings.ResourceType.STATIC;d.creativeType=google.ima.CompanionAdSelectionSettings.CreativeType.IMAGE;d.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.IGNORE;a.companionAds=b.getCompanionAds(a.clientWidth,a.clientHeight,d);c(a,"getted companion ads count: "+a.companionAds.length)}});a.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(b){c(a,"all ads competed");
    a.muteButton&&a.removeChild(a.muteButton);l.unobserve(a);g(a,h.COMPANION)&&a.companionAds&&a.companionAds.length?(a.innerHTML=a.companionAds[0].getContent(),a.style.height="auto",c(a,"display companion")):g(a,h.COLLAPSE)&&(a.style.display="none",c(a,"ads collapsed"));b=f(a,"on-complete");if("function"===typeof window[b])window[b]()});try{a.adsManager.init(a.clientWidth,a.clientHeight,google.ima.ViewMode.NORMAL),a.adsManager.start()}catch(d){c(a,"error or empty ad",d),q(a)}},!1),a.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,
    function(e){c(a,"error or empty ad",e.getError());"undefined"!==typeof a.adsManager&&a.adsManager.destroy();q(a)},!1),g(a,h.INIT,1),g(a,h.LOADED,0),g(a,h.STARTED,0),c(a,"init"))})};document.head.appendChild(k)})();